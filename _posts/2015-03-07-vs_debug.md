---
layout: post
title: VS基础程序调试
date: 2015-03-07 22:46:32
tags: [Visual Studio] Debug Windows
categories: tech
---

程序生成后,必须纠正那些使应用程序或存储过程无法正确运行的逻辑错误。可以用开发环境集成调试功能做到这一点。这些功能使我们可以在某些过程位置停止执行，检查内存和寄存器值，更改变量，观察消息通信量，以及仔细查看代码的行为。

## 1 VS调试器

Visual Studio 调试器是一个功能强大的工具，它使我们可以观察程序的运行时行为并确定逻辑错误的位置。该调试器可用于所有的 Visual Studio 编程语言及其关联的库。使用调试器，可以中断(或挂起)程序的执行以检查代码，计算和编辑程序中的变量，查看寄存器，查看从源代码创建的指令，以及查看应用程序所占用的内存空间。使用"编辑并继续"，可以在调试时对代码进行更改，然后继续执行。
Visual Studio 调试器提供了一个用于访问调试器工具的"调试"菜单。调试器的窗口和对话框显示有关您的程序的信息，并允许输入附加的信息。可以通过按 F1 获得关于任何窗口或对话框的帮助。

## 2 断点

断点是一个信号，它通知调试器，在某个特定点上暂时将程序执行挂起。当执行在某个断点处挂起时，我们称程序处于中断模式。进入中断模式并不会终止或结束程序的执行。执行可以在任何时候继续。
断点提供了一种强大的工具，使我们能够在需要的时间和位置挂起执行。与逐句或逐条指令地检查代码不同的是，可以让程序一直执行，直到遇到断点，然后开始调试。这大大地加快了调试过程。没有这个功能，调试大的程序几乎是不可能的。

## 3 VS中设置断点

### 3.1 设置简单断点

- 方法一：将鼠标置于将要设置断点的行，按F9或在调试中选择设置断点
- 方法二：单击将要设置断点的代码行的左侧边区域

### 3.2 设置函数断点

1. Debug -> New Breakpoint -> Break at Function
2. 设置断点函数以及断点在函数中的位置

### 3.3 设置数据断点

数据断点可在写入存储在指定内存位置的值时中断执行。如果只读取而不写入该值，则不会中断执行。
若要设置数据断点，必须使调试器只处于中断模式下。

1. Debug -> New Breakpoint -> New Data Breakpoint
2. 在"地址"框中，键入内存地址或计算结果为内存地址的表达式。

例如，输入 &avar ，则当变量 avar 的内容更改时中断。
在"字节计数"框中，键入希望调试器监视的字节数。例如，如果键入 4，调试器将监视从 &myFunction 开始的四个字节，并在其中有任何字节的值发生更改时中断。

## 4 执行控制

VS中程序在断点位置中断后有多种控制命令：

### 4.1 逐过程(Step Over)

调试器执行到断点后，你可能需要一条一条的执行代码。"Step Over"(F10)命令用于一条一条的执行代码。这将执行当前高亮的行，然后暂停。如果在一条方法调用语句高亮时按F10，执行会停在调用语句的下一条语句上。Step Over会一次整个方法。

### 4.2 逐语句(Step Into)

它与Step Over相似。唯一的不同是，如果当前高亮语句是方法调用，调试器会进入方法内部。快捷键是"F11"。

### 4.3 跳出(Step Out)

在一个方法内部调试时会用到它。如果在当前方法内按Shift - F11，调试器会完成此方法的执行，之后在调用此方法的语句的下一条语句处暂停。

### 4.4 继续(Continue)

它像是重新执行程序。它会继续程序的执行直到遇到下一个断点。快捷键是"F5"。

### 4.5 设置下一语句(Set Next Statement)

这是一个非常有趣的特性。设置下一语句允许你在调试的时候改变程序的执行路径。如果程序在某一行处暂停而且你想改变执行路径，跳到指定行，在这一行上右击，在右击菜单中选择"设置下一语句"。这样程序就会转到哪一行执行而不执行先前的代码。这在如下情况中非常有用：当你发现代码中某些行可能会导致程序的中断(break)而你不想让程序在那个时候中断。快捷键是Ctrl + Shift + F10。

### 4.6 显示下一语句(Show Next Statement [Ctrl+\*])

这一行用黄色箭头标记。这行是程序继续执行时下一条将执行的语句。

## 5 程序调试：

1. 点击"开始调试(Start Debugging)"或F5，进行调试
2. 当程序执行到断点处，执行暂停(处于中断模式)
3. 此时可检查变量的值
  - 方法一：将鼠标指针悬停在该变量上方，该变量的值将显示
  - 方法二：将鼠标放在某变量上，单击鼠标右键，并"添加监视"(Add Watch),该变量的名字和值将会在生成的"监视窗"显示
4. 此时可选择"逐行"调试或F11、"逐过程"调试或F10,如连续按F10，可查看表中的值的变化
5. 直到程序尾，结束调试

## 6 断点设置

### 6.1 设置断点条件

Condition 是一个表达式，它确定断点是命中还是跳过。当调试器到达该断点时，它会计算条件的值。只有当条件满足时，断点才会命中。可以在某个位置断点处设置条件，只有当条件为真时，才会中断执行。例如调试一个银行程序，其中的帐户余额不允许小于零。可以在代码中的某些位置设置断点并附加以下条件：balance < 0。运行程序时，当余额小于零时，执行就会在这些位置中断。然后，就可以在第一个断点处检查变量和程序状态，再继续执行到第二个断点位置，如此继续。
条件可以是调试器可识别的任何有效表达式。
在Breakpoints右键设置Condition

### 6.2 设置断点命中次数

Hit Count 使程序能够确定在调试器中断执行之前命中断点的次数。在默认情况下，每次命中断点，调试器就中断执行。通过设置命中次数，可以让调试器每命中两次断点中断执行一次，也可以每 10 次、每 512 次或任意选择的次数中断一次。程序中的某些 bug 不会在第一次执行循环、调用函数或访问变量时显现出来，这时候命中次数设置就很有用了。有些时候，bug 直到重复 100 次或 1000 次时才显现出来。此时可以设置命中次数为 100 或 1000 以解决问题。
默认情况下，每次命中断点时执行都中断。可以选择：
  - a.总是中断(默认设置)。
  - b.命中次数等于指定值时中断。
  - c.命中次数等于指定值的倍数时中断。
  - d.命中次数大于或等于指定值时中断。
如果要跟踪断点的命中次数但不中断执行，可以将命中次数设置为一个很高的值以便永不命中断点。
仅为调试会话保留指定的命中次数。在调试会话结束时，命中次数将重置为零。
设置方法:在Breakpoints右键设置Hit Count

### 6.3 启用或禁用断点：
在Breakpoints窗口勾选或去勾选相应断点

### 6.4 删除断点：
在Breakpoints右键删除相应断点
